<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Napoleonic Wars - Simple Strategy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
            padding: 20px;
            touch-action: manipulation;
        }

        .game-container {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.4em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            opacity: 0.9;
        }

        .top-row {
            display: grid;
            grid-template-columns: 1.1fr 1.3fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .player-panel {
            background: rgba(255,255,255,0.1);
            padding: 18px;
            border-radius: 15px;
            border: 3px solid;
            min-height: 150px;
        }

        .player-panel.french {
            border-color: #3498db;
        }

        .player-panel.coalition {
            border-color: #e74c3c;
        }

        .player-panel.active {
            box-shadow: 0 0 25px rgba(255,255,255,0.6);
        }

        .player-panel h2 {
            font-size: 1.8em;
            margin-bottom: 8px;
        }

        .stat {
            font-size: 1.2em;
            margin: 6px 0;
            padding: 6px 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .stat small {
            font-size: 0.75em;
            opacity: 0.9;
        }

        /* SIMPLE FRONT-LINE VIEW */
        .frontline {
            background: rgba(0,0,0,0.35);
            padding: 15px;
            border-radius: 15px;
        }

        .frontline h3 {
            text-align: center;
            font-size: 1.6em;
            margin-bottom: 10px;
        }

        .frontline-grid {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            align-items: center;
            gap: 10px;
        }

        .brigade-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .brigade-box {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            min-height: 60px;
        }

        .brigade-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .brigade-stat {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .frontline-divider {
            text-align: center;
            font-size: 2em;
        }

        .start-screen {
            text-align: center;
            margin: 15px 0;
            padding: 16px;
            background: rgba(0,0,0,0.4);
            border-radius: 16px;
        }

        .start-screen p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .start-btn {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            color: #2c3e50;
        }

        .battlefield {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 200px;
        }

        .battlefield h3 {
            font-size: 1.7em;
            margin-bottom: 10px;
            text-align: center;
        }

        .battle-log {
            font-size: 1.2em;
            line-height: 1.6;
            max-height: 180px;
            overflow-y: auto;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .battle-log p {
            margin: 6px 0;
            padding: 6px;
            border-left: 4px solid #3498db;
            background: rgba(255,255,255,0.05);
        }

        .turn-indicator {
            text-align: center;
            margin-top: 6px;
            font-size: 1.1em;
            opacity: 0.9;
        }

        .actions-area {
            background: rgba(0,0,0,0.35);
            padding: 20px;
            border-radius: 15px;
        }

        .actions-title {
            text-align: center;
            font-size: 1.6em;
            margin-bottom: 6px;
        }

        .actions-subtitle {
            text-align: center;
            font-size: 1em;
            margin-bottom: 14px;
            opacity: 0.9;
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 16px;
            margin-bottom: 10px;
        }

        button {
            font-size: 1.3em;
            padding: 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-height: 80px;
        }

        button:hover {
            transform: scale(1.04);
        }

        button:active {
            transform: scale(0.97);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .attack-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .defend-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .cavalry-btn {
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
            color: white;
        }

        .artillery-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .sector-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        .sector-btn {
            background: rgba(255,255,255,0.12);
            color: #ecf0f1;
            font-size: 1.1em;
            min-height: 60px;
        }

        .sector-btn.active {
            background: rgba(241,196,15,0.9);
            color: #2c3e50;
        }

        .hint-text {
            text-align: center;
            font-size: 0.95em;
            margin-top: 8px;
            opacity: 0.85;
        }

        .game-over {
            text-align: center;
            font-size: 2em;
            padding: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            margin-top: 20px;
        }

        .new-game-btn {
            background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
            color: white;
            margin-top: 15px;
        }

        @media (max-width: 900px) {
            .top-row {
                grid-template-columns: 1fr;
            }

            button {
                font-size: 1.2em;
                padding: 16px;
            }
        }
    </style>
</head>
<body>
<div class="game-container">
    <h1>‚öîÔ∏è Napoleonic Battle ‚öîÔ∏è</h1>
    <div class="subtitle">Very simple turn‚Äëbased game ‚Äì ideal for iPads and older players</div>

    <!-- Background music (looping). Note: these documents can only be used in code execution -->
    <audio id="bgMusic" src="war-military-army-background-music-421689.mp3" loop></audio>

    <!-- Start screen to enable music on iPad -->
    <div class="start-screen" id="startScreen">
        <p>Tap ‚ÄúStart Battle‚Äù to begin and turn on the music.</p>
        <button class="start-btn" onclick="startGame()">‚ñ∂ Start Battle</button>
    </div>

    <div class="top-row">
        <div class="player-panels">
            <div class="player-panel french" id="frenchPanel">
                <h2>üá´üá∑ French Army</h2>
                <div class="stat">Total Troops: <span id="frenchTroops">100</span></div>
                <div class="stat">Morale: <span id="frenchMorale">100</span></div>
                <div class="stat">
                    Artillery: <span id="frenchArtillery">5</span>
                    <br><small>(Used for cannon barrages)</small>
                </div>
            </div>

            <div class="player-panel coalition" id="coalitionPanel">
                <h2>üá¨üáß Allied Army</h2>
                <div class="stat">Total Troops: <span id="coalitionTroops">100</span></div>
                <div class="stat">Morale: <span id="coalitionMorale">100</span></div>
                <div class="stat">
                    Artillery: <span id="coalitionArtillery">5</span>
                    <br><small>(Used for cannon barrages)</small>
                </div>
            </div>
        </div>

        <!-- Simple ‚Äúmap‚Äù: three sectors per side -->
        <div class="frontline">
            <h3>Front Line Sectors</h3>
            <div class="frontline-grid">
                <div class="brigade-column">
                    <div class="brigade-box">
                        <div class="brigade-name">üá´üá∑ Left</div>
                        <div class="brigade-stat">Brigade strength: <span id="frenchLeft">34</span></div>
                    </div>
                    <div class="brigade-box">
                        <div class="brigade-name">üá´üá∑ Center</div>
                        <div class="brigade-stat">Brigade strength: <span id="frenchCenter">33</span></div>
                    </div>
                    <div class="brigade-box">
                        <div class="brigade-name">üá´üá∑ Right</div>
                        <div class="brigade-stat">Brigade strength: <span id="frenchRight">33</span></div>
                    </div>
                </div>

                <div class="frontline-divider">
                    ‚öîÔ∏è
                </div>

                <div class="brigade-column">
                    <div class="brigade-box">
                        <div class="brigade-name">Allied Left üá¨üáß</div>
                        <div class="brigade-stat">Brigade strength: <span id="coalitionLeft">34</span></div>
                    </div>
                    <div class="brigade-box">
                        <div class="brigade-name">Allied Center üá¨üáß</div>
                        <div class="brigade-stat">Brigade strength: <span id="coalitionCenter">33</span></div>
                    </div>
                    <div class="brigade-box">
                        <div class="brigade-name">Allied Right üá¨üáß</div>
                        <div class="brigade-stat">Brigade strength: <span id="coalitionRight">33</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="battlefield">
        <h3>üìú Battle Report</h3>
        <div class="battle-log" id="battleLog">
            <p>Two great armies face each other on a muddy field. Each turn, choose one action and one sector. Simple rules, hard choices.</p>
        </div>
        <div class="turn-indicator" id="turnIndicator">
            Turn 1 ‚Äì üá´üá∑ French Army to act.
        </div>
    </div>

    <div class="actions-area" id="actionsArea">
        <div class="actions-title">Choose Your Action</div>
        <div class="actions-subtitle">Step 1: Pick an action. Step 2: Pick a sector (Left, Center, or Right).</div>

        <div class="actions">
            <button class="attack-btn" onclick="selectAction('infantry')">‚öîÔ∏è Infantry Attack</button>
            <button class="cavalry-btn" onclick="selectAction('cavalry')">üêé Cavalry Charge</button>
            <button class="artillery-btn" onclick="selectAction('artillery')">üí£ Artillery Barrage</button>
            <button class="defend-btn" onclick="selectAction('defend')">üõ°Ô∏è Strengthen Position</button>
        </div>

        <div class="sector-buttons">
            <button class="sector-btn" id="sectorLeftBtn" onclick="selectSector('left')">Attack Left</button>
            <button class="sector-btn" id="sectorCenterBtn" onclick="selectSector('center')">Attack Center</button>
            <button class="sector-btn" id="sectorRightBtn" onclick="selectSector('right')">Attack Right</button>
        </div>

        <div class="hint-text" id="hintText">
            No action chosen yet. Tap one of the big red, yellow, purple, or blue buttons.
        </div>
    </div>

    <div id="gameOverScreen" style="display: none;">
        <div class="game-over">
            <h2 id="winnerText"></h2>
            <button class="new-game-btn" onclick="newGame()">üîÑ New Campaign</button>
        </div>
    </div>
</div>

<script>
    // GAME STATE
    let gameState = {
        currentPlayer: 'french',
        turn: 1,
        actionTaken: false,
        selectedAction: null,
        selectedSector: null,
        french: {
            totalTroops: 100,
            morale: 100,
            artillery: 5,
            defending: false,
            left: 34,
            center: 33,
            right: 33
        },
        coalition: {
            totalTroops: 100,
            morale: 100,
            artillery: 5,
            defending: false,
            left: 34,
            center: 33,
            right: 33
        }
    };

    let musicStarted = false;

    function startGame() {
        document.getElementById('startScreen').style.display = 'none';

        const bgMusic = document.getElementById('bgMusic');
        if (!musicStarted) {
            bgMusic.volume = 0.5;
            bgMusic.play().catch(err => {
                console.log('Autoplay blocked:', err);
            });
            musicStarted = true;
        }
    }

    // INITIAL SETUP
    function init() {
        updateDisplay();
        updateActivePlayer();
    }

    // UPDATE DISPLAY
    function updateDisplay() {
        // Global stats
        document.getElementById('frenchTroops').textContent = gameState.french.totalTroops;
        document.getElementById('frenchMorale').textContent = gameState.french.morale;
        document.getElementById('frenchArtillery').textContent = gameState.french.artillery;

        document.getElementById('coalitionTroops').textContent = gameState.coalition.totalTroops;
        document.getElementById('coalitionMorale').textContent = gameState.coalition.morale;
        document.getElementById('coalitionArtillery').textContent = gameState.coalition.artillery;

        // Brigades
        document.getElementById('frenchLeft').textContent = gameState.french.left;
        document.getElementById('frenchCenter').textContent = gameState.french.center;
        document.getElementById('frenchRight').textContent = gameState.french.right;

        document.getElementById('coalitionLeft').textContent = gameState.coalition.left;
        document.getElementById('coalitionCenter').textContent = gameState.coalition.center;
        document.getElementById('coalitionRight').textContent = gameState.coalition.right;

        // Turn indicator
        const sideName = gameState.currentPlayer === 'french' ? 'üá´üá∑ French Army' : 'üá¨üáß Allied Army';
        document.getElementById('turnIndicator').textContent =
            `Turn ${gameState.turn} ‚Äì ${sideName} to act.`;
    }

    function updateActivePlayer() {
        const frenchPanel = document.getElementById('frenchPanel');
        const coalitionPanel = document.getElementById('coalitionPanel');

        if (gameState.currentPlayer === 'french') {
            frenchPanel.classList.add('active');
            coalitionPanel.classList.remove('active');
        } else {
            coalitionPanel.classList.add('active');
            frenchPanel.classList.remove('active');
        }
    }

    function addLog(message) {
        const log = document.getElementById('battleLog');
        const p = document.createElement('p');
        p.textContent = message;
        log.appendChild(p);
        log.scrollTop = log.scrollHeight;
    }

    // ACTION + SECTOR SELECTION
    function selectAction(action) {
        if (gameState.actionTaken) return;

        gameState.selectedAction = action;

        let text = '';
        switch (action) {
            case 'infantry':
                text = 'Infantry Attack chosen. Now tap Left, Center, or Right sector.';
                break;
            case 'cavalry':
                text = 'Cavalry Charge chosen. Choose a sector to thunder into.';
                break;
            case 'artillery':
                text = 'Artillery Barrage chosen. Pick the sector to bombard.';
                break;
            case 'defend':
                text = 'Strengthen Position chosen. Pick which sector to fortify.';
                break;
        }
        document.getElementById('hintText').textContent = text;
    }

    function clearSectorHighlights() {
        document.getElementById('sectorLeftBtn').classList.remove('active');
        document.getElementById('sectorCenterBtn').classList.remove('active');
        document.getElementById('sectorRightBtn').classList.remove('active');
    }

    function selectSector(sector) {
        if (gameState.actionTaken) return;
        if (!gameState.selectedAction) {
            document.getElementById('hintText').textContent =
                'First tap an action, then choose a sector.';
            return;
        }

        gameState.selectedSector = sector;
        clearSectorHighlights();

        if (sector === 'left') {
            document.getElementById('sectorLeftBtn').classList.add('active');
        } else if (sector === 'center') {
            document.getElementById('sectorCenterBtn').classList.add('active');
        } else if (sector === 'right') {
            document.getElementById('sectorRightBtn').classList.add('active');
        }

        document.getElementById('hintText').textContent = 'Action and sector chosen. Resolving attack...';
        resolveAction();
    }

    // UTILITY HELPERS
    function getSideObjects() {
        const attacker = gameState[gameState.currentPlayer];
        const defender = gameState[gameState.currentPlayer === 'french' ? 'coalition' : 'french'];
        return { attacker, defender };
    }

    function getSectorPair(sector, attacker, defender) {
        const mapping = {
            left: ['left', 'left'],
            center: ['center', 'center'],
            right: ['right', 'right']
        };
        const [aKey, dKey] = mapping[sector];
        return {
            attackerBrigadeKey: aKey,
            defenderBrigadeKey: dKey,
            attackerBrigade: attacker[aKey],
            defenderBrigade: defender[dKey]
        };
    }

    // RANDOM EVENT (simple, text only)
    function applyRandomEvent(baseDamage) {
        const roll = Math.random();
        let message = null;

        if (roll < 0.10) {
            // Heavy rain / mud
            baseDamage = Math.floor(baseDamage * 0.6);
            message = 'Heavy rain and mud slow the attack.';
        } else if (roll > 0.90) {
            // Lucky volley
            baseDamage = Math.floor(baseDamage * 1.4);
            message = 'A lucky volley finds its mark!';
        }

        return { damage: baseDamage, message };
    }

    // RESOLVE ACTION
    function resolveAction() {
        if (gameState.actionTaken) return;

        const { attacker, defender } = getSideObjects();
        const sector = gameState.selectedSector;

        const { attackerBrigadeKey, defenderBrigadeKey } =
            getSectorPair(sector, attacker, defender);

        let logText = '';
        const sideName = gameState.currentPlayer === 'french'
            ? 'üá´üá∑ French Army'
            : 'üá¨üáß Allied Army';

        // INFANTRY
        if (gameState.selectedAction === 'infantry') {
            let damage = Math.floor(Math.random() * 12) + 8;
            let moraleDamage = Math.floor(Math.random() * 6) + 4;

            // Random event
            const eventResult = applyRandomEvent(damage);
            damage = eventResult.damage;
            if (eventResult.message) {
                addLog(eventResult.message);
            }

            if (defender.defending) {
                damage = Math.floor(damage * 0.7);
                moraleDamage = Math.floor(moraleDamage * 0.6);
                logText = `${sideName} attacks the ${sector.toUpperCase()} sector, but the enemy is dug in. ${damage} casualties.`;
            } else {
                logText = `${sideName} launches an infantry attack on the ${sector.toUpperCase()} sector. ${damage} casualties inflicted.`;
            }

            defender[defenderBrigadeKey] = Math.max(0, defender[defenderBrigadeKey] - damage);
            defender.totalTroops = Math.max(0, defender.totalTroops - damage);
            defender.morale = Math.max(0, defender.morale - moraleDamage);

            // Small self-loss
            const selfLoss = Math.floor(Math.random() * 4) + 2;
            attacker[attackerBrigadeKey] = Math.max(0, attacker[attackerBrigadeKey] - selfLoss);
            attacker.totalTroops = Math.max(0, attacker.totalTroops - selfLoss);
        }

        // CAVALRY
        else if (gameState.selectedAction === 'cavalry') {
            let damage = Math.floor(Math.random() * 20) + 12;
            let moraleDamage = Math.floor(Math.random() * 10) + 8;

            const eventResult = applyRandomEvent(damage);
            damage = eventResult.damage;
            if (eventResult.message) {
                addLog(eventResult.message);
            }

            if (defender.defending) {
                damage = Math.floor(damage * 0.5);
                moraleDamage = Math.floor(moraleDamage * 0.7);
                logText = `${sideName} cavalry charges the ${sector.toUpperCase()} sector but is met by steady squares. Heavy losses.`;
                const selfLoss = Math.floor(Math.random() * 10) + 8;
                attacker[attackerBrigadeKey] = Math.max(0, attacker[attackerBrigadeKey] - selfLoss);
                attacker.totalTroops = Math.max(0, attacker.totalTroops - selfLoss);
            } else {
                logText = `${sideName} cavalry thunders into the ${sector.toUpperCase()} sector, scattering enemy troops. ${damage} casualties.`;
                const selfLoss = Math.floor(Math.random() * 6) + 3;
                attacker[attackerBrigadeKey] = Math.max(0, attacker[attackerBrigadeKey] - selfLoss);
                attacker.totalTroops = Math.max(0, attacker.totalTroops - selfLoss);
            }

            defender[defenderBrigadeKey] = Math.max(0, defender[defenderBrigadeKey] - damage);
            defender.totalTroops = Math.max(0, defender.totalTroops - damage);
            defender.morale = Math.max(0, defender.morale - moraleDamage);
        }

        // ARTILLERY
        else if (gameState.selectedAction === 'artillery') {
            if (attacker.artillery <= 0) {
                addLog(`${sideName} has no artillery left to fire! The turn is wasted.`);
                gameState.actionTaken = true;
                gameState.selectedAction = null;
                gameState.selectedSector = null;
                clearSectorHighlights();
                updateDisplay();
                checkGameOver();
                setTimeout(endTurn, 1200);
                return;
            }

            let damage = Math.floor(Math.random() * 18) + 18;
            let moraleDamage = Math.floor(Math.random() * 10) + 8;
            const eventResult = applyRandomEvent(damage);
            damage = eventResult.damage;
            if (eventResult.message) {
                addLog(eventResult.message);
            }

            logText = `${sideName} opens artillery fire on the ${sector.toUpperCase()} sector. ${damage} casualties.`;
            defender[defenderBrigadeKey] = Math.max(0, defender[defenderBrigadeKey] - damage);
            defender.totalTroops = Math.max(0, defender.totalTroops - damage);
            defender.morale = Math.max(0, defender.morale - moraleDamage);
            attacker.artillery = Math.max(0, attacker.artillery - 1);
        }

        // DEFEND
        else if (gameState.selectedAction === 'defend') {
            attacker.defending = true;
            attacker.morale = Math.min(120, attacker.morale + 6);
            logText = `${sideName} strengthens its position in the ${sector.toUpperCase()} sector. Morale rises slightly.`;
        }

        if (logText) addLog(logText);

        gameState.actionTaken = true;
        gameState.selectedAction = null;
        gameState.selectedSector = null;
        clearSectorHighlights();

        updateDisplay();
        checkGameOver();
        setTimeout(endTurn, 1400);
    }

    function getCurrentPlayerName() {
        return gameState.currentPlayer === 'french'
            ? 'üá´üá∑ French Army'
            : 'üá¨üáß Allied Army';
    }

    function checkGameOver() {
        if (gameState.french.totalTroops <= 0 || gameState.french.morale <= 0) {
            endGame('coalition');
        } else if (gameState.coalition.totalTroops <= 0 || gameState.coalition.morale <= 0) {
            endGame('french');
        }
    }

    function endGame(winner) {
        document.getElementById('actionsArea').style.display = 'none';
        document.getElementById('gameOverScreen').style.display = 'block';

        const winnerText = winner === 'french'
            ? 'üá´üá∑ French Victory!'
            : 'üá¨üáß Allied Victory!';

        document.getElementById('winnerText').textContent = winnerText;
        addLog(winnerText);
    }

    function endTurn() {
        if (!gameState.actionTaken) return;

        gameState[gameState.currentPlayer].defending = false;
        gameState.currentPlayer = gameState.currentPlayer === 'french' ? 'coalition' : 'french';
        gameState.actionTaken = false;

        if (gameState.currentPlayer === 'french') {
            gameState.turn++;
            addLog(`--- Turn ${gameState.turn} begins ---`);
        }

        document.getElementById('hintText').textContent =
            'Step 1: Pick an action. Step 2: Pick a sector (Left, Center, or Right).';
        updateActivePlayer();
        updateDisplay();
    }

    function newGame() {
        gameState = {
            currentPlayer: 'french',
            turn: 1,
            actionTaken: false,
            selectedAction: null,
            selectedSector: null,
            french: {
                totalTroops: 100,
                morale: 100,
                artillery: 5,
                defending: false,
                left: 34,
                center: 33,
                right: 33
            },
            coalition: {
                totalTroops: 100,
                morale: 100,
                artillery: 5,
                defending: false,
                left: 34,
                center: 33,
                right: 33
            }
        };

        document.getElementById('battleLog').innerHTML =
            '<p>Two great armies face each other on a muddy field. Each turn, choose one action and one sector. Simple rules, hard choices.</p>';
        document.getElementById('actionsArea').style.display = 'block';
        document.getElementById('gameOverScreen').style.display = 'none';
        document.getElementById('hintText').textContent =
            'Step 1: Pick an action. Step 2: Pick a sector (Left, Center, or Right).';
        clearSectorHighlights();
        updateDisplay();
        updateActivePlayer();
    }

    // Start base setup
    init();
</script>
</body>
</html>